{"ast":null,"code":"/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * @file contract.js\n *\n * To initialize a contract use:\n *\n *  var Contract = require('web3-eth-contract');\n *  Contract.setProvider('ws://localhost:8546');\n *  var contract = new Contract(abi, address, ...);\n *\n * @author Fabian Vogelsteller <fabian@ethereum.org>\n * @date 2017\n */\n\"use strict\";\n\nvar _ = require('underscore');\n\nvar core = require('web3-core');\n\nvar Method = require('web3-core-method');\n\nvar utils = require('web3-utils');\n\nvar Subscription = require('web3-core-subscriptions').subscription;\n\nvar formatters = require('web3-core-helpers').formatters;\n\nvar errors = require('web3-core-helpers').errors;\n\nvar promiEvent = require('web3-core-promievent');\n\nvar abi = require('web3-eth-abi');\n/**\n * Should be called to create new contract instance\n *\n * @method Contract\n * @constructor\n * @param {Array} jsonInterface\n * @param {String} address\n * @param {Object} options\n */\n\n\nvar Contract = function Contract(jsonInterface, address, options) {\n  var _this = this,\n      args = Array.prototype.slice.call(arguments);\n\n  if (!(this instanceof Contract)) {\n    throw new Error('Please use the \"new\" keyword to instantiate a web3.eth.Contract() object!');\n  }\n\n  this.setProvider = function () {\n    core.packageInit(_this, arguments);\n    _this.clearSubscriptions = _this._requestManager.clearSubscriptions;\n  }; // sets _requestmanager\n\n\n  core.packageInit(this, [this.constructor]);\n  this.clearSubscriptions = this._requestManager.clearSubscriptions;\n\n  if (!jsonInterface || !Array.isArray(jsonInterface)) {\n    throw errors.ContractMissingABIError();\n  } // create the options object\n\n\n  this.options = {};\n  var lastArg = args[args.length - 1];\n\n  if (_.isObject(lastArg) && !_.isArray(lastArg)) {\n    options = lastArg;\n    this.options = _.extend(this.options, this._getOrSetDefaultOptions(options));\n\n    if (_.isObject(address)) {\n      address = null;\n    }\n  } // set address\n\n\n  Object.defineProperty(this.options, 'address', {\n    set: function (value) {\n      if (value) {\n        _this._address = utils.toChecksumAddress(formatters.inputAddressFormatter(value));\n      }\n    },\n    get: function () {\n      return _this._address;\n    },\n    enumerable: true\n  }); // add method and event signatures, when the jsonInterface gets set\n\n  Object.defineProperty(this.options, 'jsonInterface', {\n    set: function (value) {\n      _this.methods = {};\n      _this.events = {};\n      _this._jsonInterface = value.map(function (method) {\n        var func, funcName; // make constant and payable backwards compatible\n\n        method.constant = method.stateMutability === \"view\" || method.stateMutability === \"pure\" || method.constant;\n        method.payable = method.stateMutability === \"payable\" || method.payable;\n\n        if (method.name) {\n          funcName = utils._jsonInterfaceMethodToString(method);\n        } // function\n\n\n        if (method.type === 'function') {\n          method.signature = abi.encodeFunctionSignature(funcName);\n          func = _this._createTxObject.bind({\n            method: method,\n            parent: _this\n          }); // add method only if not one already exists\n\n          if (!_this.methods[method.name]) {\n            _this.methods[method.name] = func;\n          } else {\n            var cascadeFunc = _this._createTxObject.bind({\n              method: method,\n              parent: _this,\n              nextMethod: _this.methods[method.name]\n            });\n\n            _this.methods[method.name] = cascadeFunc;\n          } // definitely add the method based on its signature\n\n\n          _this.methods[method.signature] = func; // add method by name\n\n          _this.methods[funcName] = func; // event\n        } else if (method.type === 'event') {\n          method.signature = abi.encodeEventSignature(funcName);\n\n          var event = _this._on.bind(_this, method.signature); // add method only if not already exists\n\n\n          if (!_this.events[method.name] || _this.events[method.name].name === 'bound ') _this.events[method.name] = event; // definitely add the method based on its signature\n\n          _this.events[method.signature] = event; // add event by name\n\n          _this.events[funcName] = event;\n        }\n\n        return method;\n      }); // add allEvents\n\n      _this.events.allEvents = _this._on.bind(_this, 'allevents');\n      return _this._jsonInterface;\n    },\n    get: function () {\n      return _this._jsonInterface;\n    },\n    enumerable: true\n  }); // get default account from the Class\n\n  var defaultAccount = this.constructor.defaultAccount;\n  var defaultBlock = this.constructor.defaultBlock || 'latest';\n  Object.defineProperty(this, 'handleRevert', {\n    get: function () {\n      if (_this.options.handleRevert === false || _this.options.handleRevert === true) {\n        return _this.options.handleRevert;\n      }\n\n      return this.constructor.handleRevert;\n    },\n    set: function (val) {\n      _this.options.handleRevert = val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'defaultCommon', {\n    get: function () {\n      return _this.options.common || this.constructor.defaultCommon;\n    },\n    set: function (val) {\n      _this.options.common = val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'defaultHardfork', {\n    get: function () {\n      return _this.options.hardfork || this.constructor.defaultHardfork;\n    },\n    set: function (val) {\n      _this.options.hardfork = val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'defaultChain', {\n    get: function () {\n      return _this.options.chain || this.constructor.defaultChain;\n    },\n    set: function (val) {\n      _this.options.chain = val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'transactionPollingTimeout', {\n    get: function () {\n      if (_this.options.transactionPollingTimeout === 0) {\n        return _this.options.transactionPollingTimeout;\n      }\n\n      return _this.options.transactionPollingTimeout || this.constructor.transactionPollingTimeout;\n    },\n    set: function (val) {\n      _this.options.transactionPollingTimeout = val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'transactionConfirmationBlocks', {\n    get: function () {\n      if (_this.options.transactionConfirmationBlocks === 0) {\n        return _this.options.transactionConfirmationBlocks;\n      }\n\n      return _this.options.transactionConfirmationBlocks || this.constructor.transactionConfirmationBlocks;\n    },\n    set: function (val) {\n      _this.options.transactionConfirmationBlocks = val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'transactionBlockTimeout', {\n    get: function () {\n      if (_this.options.transactionBlockTimeout === 0) {\n        return _this.options.transactionBlockTimeout;\n      }\n\n      return _this.options.transactionBlockTimeout || this.constructor.transactionBlockTimeout;\n    },\n    set: function (val) {\n      _this.options.transactionBlockTimeout = val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'defaultAccount', {\n    get: function () {\n      return defaultAccount;\n    },\n    set: function (val) {\n      if (val) {\n        defaultAccount = utils.toChecksumAddress(formatters.inputAddressFormatter(val));\n      }\n\n      return val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'defaultBlock', {\n    get: function () {\n      return defaultBlock;\n    },\n    set: function (val) {\n      defaultBlock = val;\n      return val;\n    },\n    enumerable: true\n  }); // properties\n\n  this.methods = {};\n  this.events = {};\n  this._address = null;\n  this._jsonInterface = []; // set getter/setter properties\n\n  this.options.address = address;\n  this.options.jsonInterface = jsonInterface;\n};\n/**\n * Sets the new provider, creates a new requestManager, registers the \"data\" listener on the provider and sets the\n * accounts module for the Contract class.\n *\n * @method setProvider\n *\n * @param {string|provider} provider\n * @param {Accounts} accounts\n *\n * @returns void\n */\n\n\nContract.setProvider = function (provider, accounts) {\n  // Contract.currentProvider = provider;\n  core.packageInit(this, [provider]);\n  this._ethAccounts = accounts;\n};\n/**\n * Get the callback and modify the array if necessary\n *\n * @method _getCallback\n * @param {Array} args\n * @return {Function} the callback\n */\n\n\nContract.prototype._getCallback = function getCallback(args) {\n  if (args && _.isFunction(args[args.length - 1])) {\n    return args.pop(); // modify the args array!\n  }\n};\n/**\n * Checks that no listener with name \"newListener\" or \"removeListener\" is added.\n *\n * @method _checkListener\n * @param {String} type\n * @param {String} event\n * @return {Object} the contract instance\n */\n\n\nContract.prototype._checkListener = function (type, event) {\n  if (event === type) {\n    throw errors.ContractReservedEventError(type);\n  }\n};\n/**\n * Use default values, if options are not available\n *\n * @method _getOrSetDefaultOptions\n * @param {Object} options the options gived by the user\n * @return {Object} the options with gaps filled by defaults\n */\n\n\nContract.prototype._getOrSetDefaultOptions = function getOrSetDefaultOptions(options) {\n  var gasPrice = options.gasPrice ? String(options.gasPrice) : null;\n  var from = options.from ? utils.toChecksumAddress(formatters.inputAddressFormatter(options.from)) : null;\n  options.data = options.data || this.options.data;\n  options.from = from || this.options.from;\n  options.gasPrice = gasPrice || this.options.gasPrice;\n  options.gas = options.gas || options.gasLimit || this.options.gas; // TODO replace with only gasLimit?\n\n  delete options.gasLimit;\n  return options;\n};\n/**\n * Should be used to encode indexed params and options to one final object\n *\n * @method _encodeEventABI\n * @param {Object} event\n * @param {Object} options\n * @return {Object} everything combined together and encoded\n */\n\n\nContract.prototype._encodeEventABI = function (event, options) {\n  options = options || {};\n  var filter = options.filter || {},\n      result = {};\n  ['fromBlock', 'toBlock'].filter(function (f) {\n    return options[f] !== undefined;\n  }).forEach(function (f) {\n    result[f] = formatters.inputBlockNumberFormatter(options[f]);\n  }); // use given topics\n\n  if (_.isArray(options.topics)) {\n    result.topics = options.topics; // create topics based on filter\n  } else {\n    result.topics = []; // add event signature\n\n    if (event && !event.anonymous && event.name !== 'ALLEVENTS') {\n      result.topics.push(event.signature);\n    } // add event topics (indexed arguments)\n\n\n    if (event.name !== 'ALLEVENTS') {\n      var indexedTopics = event.inputs.filter(function (i) {\n        return i.indexed === true;\n      }).map(function (i) {\n        var value = filter[i.name];\n\n        if (!value) {\n          return null;\n        } // TODO: https://github.com/ethereum/web3.js/issues/344\n        // TODO: deal properly with components\n\n\n        if (_.isArray(value)) {\n          return value.map(function (v) {\n            return abi.encodeParameter(i.type, v);\n          });\n        }\n\n        return abi.encodeParameter(i.type, value);\n      });\n      result.topics = result.topics.concat(indexedTopics);\n    }\n\n    if (!result.topics.length) delete result.topics;\n  }\n\n  if (this.options.address) {\n    result.address = this.options.address.toLowerCase();\n  }\n\n  return result;\n};\n/**\n * Should be used to decode indexed params and options\n *\n * @method _decodeEventABI\n * @param {Object} data\n * @return {Object} result object with decoded indexed && not indexed params\n */\n\n\nContract.prototype._decodeEventABI = function (data) {\n  var event = this;\n  data.data = data.data || '';\n  data.topics = data.topics || [];\n  var result = formatters.outputLogFormatter(data); // if allEvents get the right event\n\n  if (event.name === 'ALLEVENTS') {\n    event = event.jsonInterface.find(function (intf) {\n      return intf.signature === data.topics[0];\n    }) || {\n      anonymous: true\n    };\n  } // create empty inputs if none are present (e.g. anonymous events on allEvents)\n\n\n  event.inputs = event.inputs || []; // Handle case where an event signature shadows the current ABI with non-identical\n  // arg indexing. If # of topics doesn't match, event is anon.\n\n  if (!event.anonymous) {\n    let indexedInputs = 0;\n    event.inputs.forEach(input => input.indexed ? indexedInputs++ : null);\n\n    if (indexedInputs > 0 && data.topics.length !== indexedInputs + 1) {\n      event = {\n        anonymous: true,\n        inputs: []\n      };\n    }\n  }\n\n  var argTopics = event.anonymous ? data.topics : data.topics.slice(1);\n  result.returnValues = abi.decodeLog(event.inputs, data.data, argTopics);\n  delete result.returnValues.__length__; // add name\n\n  result.event = event.name; // add signature\n\n  result.signature = event.anonymous || !data.topics[0] ? null : data.topics[0]; // move the data and topics to \"raw\"\n\n  result.raw = {\n    data: result.data,\n    topics: result.topics\n  };\n  delete result.data;\n  delete result.topics;\n  return result;\n};\n/**\n * Encodes an ABI for a method, including signature or the method.\n * Or when constructor encodes only the constructor parameters.\n *\n * @method _encodeMethodABI\n * @param {Mixed} args the arguments to encode\n * @param {String} the encoded ABI\n */\n\n\nContract.prototype._encodeMethodABI = function _encodeMethodABI() {\n  var methodSignature = this._method.signature,\n      args = this.arguments || [];\n  var signature = false,\n      paramsABI = this._parent.options.jsonInterface.filter(function (json) {\n    return methodSignature === 'constructor' && json.type === methodSignature || (json.signature === methodSignature || json.signature === methodSignature.replace('0x', '') || json.name === methodSignature) && json.type === 'function';\n  }).map(function (json) {\n    var inputLength = _.isArray(json.inputs) ? json.inputs.length : 0;\n\n    if (inputLength !== args.length) {\n      throw new Error('The number of arguments is not matching the methods required number. You need to pass ' + inputLength + ' arguments.');\n    }\n\n    if (json.type === 'function') {\n      signature = json.signature;\n    }\n\n    return _.isArray(json.inputs) ? json.inputs : [];\n  }).map(function (inputs) {\n    return abi.encodeParameters(inputs, args).replace('0x', '');\n  })[0] || ''; // return constructor\n\n  if (methodSignature === 'constructor') {\n    if (!this._deployData) throw new Error('The contract has no contract data option set. This is necessary to append the constructor parameters.');\n\n    if (!this._deployData.startsWith('0x')) {\n      this._deployData = '0x' + this._deployData;\n    }\n\n    return this._deployData + paramsABI;\n  } // return method\n\n\n  var returnValue = signature ? signature + paramsABI : paramsABI;\n\n  if (!returnValue) {\n    throw new Error('Couldn\\'t find a matching contract method named \"' + this._method.name + '\".');\n  }\n\n  return returnValue;\n};\n/**\n * Decode method return values\n *\n * @method _decodeMethodReturn\n * @param {Array} outputs\n * @param {String} returnValues\n * @return {Object} decoded output return values\n */\n\n\nContract.prototype._decodeMethodReturn = function (outputs, returnValues) {\n  if (!returnValues) {\n    return null;\n  }\n\n  returnValues = returnValues.length >= 2 ? returnValues.slice(2) : returnValues;\n  var result = abi.decodeParameters(outputs, returnValues);\n\n  if (result.__length__ === 1) {\n    return result[0];\n  }\n\n  delete result.__length__;\n  return result;\n};\n/**\n * Deploys a contract and fire events based on its state: transactionHash, receipt\n *\n * All event listeners will be removed, once the last possible event is fired (\"error\", or \"receipt\")\n *\n * @method deploy\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} EventEmitter possible events are \"error\", \"transactionHash\" and \"receipt\"\n */\n\n\nContract.prototype.deploy = function (options, callback) {\n  options = options || {};\n  options.arguments = options.arguments || [];\n  options = this._getOrSetDefaultOptions(options); // throw error, if no \"data\" is specified\n\n  if (!options.data) {\n    if (typeof callback === 'function') {\n      return callback(errors.ContractMissingDeployDataError());\n    }\n\n    throw errors.ContractMissingDeployDataError();\n  }\n\n  var constructor = _.find(this.options.jsonInterface, function (method) {\n    return method.type === 'constructor';\n  }) || {};\n  constructor.signature = 'constructor';\n  return this._createTxObject.apply({\n    method: constructor,\n    parent: this,\n    deployData: options.data,\n    _ethAccounts: this.constructor._ethAccounts\n  }, options.arguments);\n};\n/**\n * Gets the event signature and outputFormatters\n *\n * @method _generateEventOptions\n * @param {Object} event\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} the event options object\n */\n\n\nContract.prototype._generateEventOptions = function () {\n  var args = Array.prototype.slice.call(arguments); // get the callback\n\n  var callback = this._getCallback(args); // get the options\n\n\n  var options = _.isObject(args[args.length - 1]) ? args.pop() : {};\n  var eventName = _.isString(args[0]) ? args[0] : 'allevents';\n  var event = eventName.toLowerCase() === 'allevents' ? {\n    name: 'ALLEVENTS',\n    jsonInterface: this.options.jsonInterface\n  } : this.options.jsonInterface.find(function (json) {\n    return json.type === 'event' && (json.name === eventName || json.signature === '0x' + eventName.replace('0x', ''));\n  });\n\n  if (!event) {\n    throw errors.ContractEventDoesNotExistError(eventName);\n  }\n\n  if (!utils.isAddress(this.options.address)) {\n    throw errors.ContractNoAddressDefinedError();\n  }\n\n  return {\n    params: this._encodeEventABI(event, options),\n    event: event,\n    callback: callback\n  };\n};\n/**\n * Adds event listeners and creates a subscription, and remove it once its fired.\n *\n * @method clone\n * @return {Object} the event subscription\n */\n\n\nContract.prototype.clone = function () {\n  return new this.constructor(this.options.jsonInterface, this.options.address, this.options);\n};\n/**\n * Adds event listeners and creates a subscription, and remove it once its fired.\n *\n * @method once\n * @param {String} event\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} the event subscription\n */\n\n\nContract.prototype.once = function (event, options, callback) {\n  var args = Array.prototype.slice.call(arguments); // get the callback\n\n  callback = this._getCallback(args);\n\n  if (!callback) {\n    throw errors.ContractOnceRequiresCallbackError();\n  } // don't allow fromBlock\n\n\n  if (options) delete options.fromBlock; // don't return as once shouldn't provide \"on\"\n\n  this._on(event, options, function (err, res, sub) {\n    sub.unsubscribe();\n\n    if (_.isFunction(callback)) {\n      callback(err, res, sub);\n    }\n  });\n\n  return undefined;\n};\n/**\n * Adds event listeners and creates a subscription.\n *\n * @method _on\n *\n * @param {String} event\n * @param {Object} options\n * @param {Function} callback\n *\n * @return {Object} the event subscription\n */\n\n\nContract.prototype._on = function () {\n  var subOptions = this._generateEventOptions.apply(this, arguments);\n\n  if (subOptions.params && subOptions.params.toBlock) {\n    delete subOptions.params.toBlock;\n    console.warn('Invalid option: toBlock. Use getPastEvents for specific range.');\n  } // prevent the event \"newListener\" and \"removeListener\" from being overwritten\n\n\n  this._checkListener('newListener', subOptions.event.name);\n\n  this._checkListener('removeListener', subOptions.event.name); // TODO check if listener already exists? and reuse subscription if options are the same.\n  // create new subscription\n\n\n  var subscription = new Subscription({\n    subscription: {\n      params: 1,\n      inputFormatter: [formatters.inputLogFormatter],\n      outputFormatter: this._decodeEventABI.bind(subOptions.event),\n      // DUBLICATE, also in web3-eth\n      subscriptionHandler: function (output) {\n        if (output.removed) {\n          this.emit('changed', output);\n        } else {\n          this.emit('data', output);\n        }\n\n        if (_.isFunction(this.callback)) {\n          this.callback(null, output, this);\n        }\n      }\n    },\n    type: 'eth',\n    requestManager: this._requestManager\n  });\n  subscription.subscribe('logs', subOptions.params, subOptions.callback || function () {});\n  return subscription;\n};\n/**\n * Get past events from contracts\n *\n * @method getPastEvents\n * @param {String} event\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} the promievent\n */\n\n\nContract.prototype.getPastEvents = function () {\n  var subOptions = this._generateEventOptions.apply(this, arguments);\n\n  var getPastLogs = new Method({\n    name: 'getPastLogs',\n    call: 'eth_getLogs',\n    params: 1,\n    inputFormatter: [formatters.inputLogFormatter],\n    outputFormatter: this._decodeEventABI.bind(subOptions.event)\n  });\n  getPastLogs.setRequestManager(this._requestManager);\n  var call = getPastLogs.buildCall();\n  getPastLogs = null;\n  return call(subOptions.params, subOptions.callback);\n};\n/**\n * returns the an object with call, send, estimate functions\n *\n * @method _createTxObject\n * @returns {Object} an object with functions to call the methods\n */\n\n\nContract.prototype._createTxObject = function _createTxObject() {\n  var args = Array.prototype.slice.call(arguments);\n  var txObject = {};\n\n  if (this.method.type === 'function') {\n    txObject.call = this.parent._executeMethod.bind(txObject, 'call');\n    txObject.call.request = this.parent._executeMethod.bind(txObject, 'call', true); // to make batch requests\n  }\n\n  txObject.send = this.parent._executeMethod.bind(txObject, 'send');\n  txObject.send.request = this.parent._executeMethod.bind(txObject, 'send', true); // to make batch requests\n\n  txObject.encodeABI = this.parent._encodeMethodABI.bind(txObject);\n  txObject.estimateGas = this.parent._executeMethod.bind(txObject, 'estimate');\n\n  if (args && this.method.inputs && args.length !== this.method.inputs.length) {\n    if (this.nextMethod) {\n      return this.nextMethod.apply(null, args);\n    }\n\n    throw errors.InvalidNumberOfParams(args.length, this.method.inputs.length, this.method.name);\n  }\n\n  txObject.arguments = args || [];\n  txObject._method = this.method;\n  txObject._parent = this.parent;\n  txObject._ethAccounts = this.parent.constructor._ethAccounts || this._ethAccounts;\n\n  if (this.deployData) {\n    txObject._deployData = this.deployData;\n  }\n\n  return txObject;\n};\n/**\n * Generates the options for the execute call\n *\n * @method _processExecuteArguments\n * @param {Array} args\n * @param {Promise} defer\n */\n\n\nContract.prototype._processExecuteArguments = function _processExecuteArguments(args, defer) {\n  var processedArgs = {};\n  processedArgs.type = args.shift(); // get the callback\n\n  processedArgs.callback = this._parent._getCallback(args); // get block number to use for call\n\n  if (processedArgs.type === 'call' && args[args.length - 1] !== true && (_.isString(args[args.length - 1]) || isFinite(args[args.length - 1]))) processedArgs.defaultBlock = args.pop(); // get the options\n\n  processedArgs.options = _.isObject(args[args.length - 1]) ? args.pop() : {}; // get the generateRequest argument for batch requests\n\n  processedArgs.generateRequest = args[args.length - 1] === true ? args.pop() : false;\n  processedArgs.options = this._parent._getOrSetDefaultOptions(processedArgs.options);\n  processedArgs.options.data = this.encodeABI(); // add contract address\n\n  if (!this._deployData && !utils.isAddress(this._parent.options.address)) throw errors.ContractNoAddressDefinedError();\n  if (!this._deployData) processedArgs.options.to = this._parent.options.address; // return error, if no \"data\" is specified\n\n  if (!processedArgs.options.data) return utils._fireError(new Error('Couldn\\'t find a matching contract method, or the number of parameters is wrong.'), defer.eventEmitter, defer.reject, processedArgs.callback);\n  return processedArgs;\n};\n/**\n * Executes a call, transact or estimateGas on a contract function\n *\n * @method _executeMethod\n * @param {String} type the type this execute function should execute\n * @param {Boolean} makeRequest if true, it simply returns the request parameters, rather than executing it\n */\n\n\nContract.prototype._executeMethod = function _executeMethod() {\n  var _this = this,\n      args = this._parent._processExecuteArguments.call(this, Array.prototype.slice.call(arguments), defer),\n      defer = promiEvent(args.type !== 'send'),\n      ethAccounts = _this.constructor._ethAccounts || _this._ethAccounts; // simple return request for batch requests\n\n\n  if (args.generateRequest) {\n    var payload = {\n      params: [formatters.inputCallFormatter.call(this._parent, args.options)],\n      callback: args.callback\n    };\n\n    if (args.type === 'call') {\n      payload.params.push(formatters.inputDefaultBlockNumberFormatter.call(this._parent, args.defaultBlock));\n      payload.method = 'eth_call';\n      payload.format = this._parent._decodeMethodReturn.bind(null, this._method.outputs);\n    } else {\n      payload.method = 'eth_sendTransaction';\n    }\n\n    return payload;\n  }\n\n  switch (args.type) {\n    case 'estimate':\n      var estimateGas = new Method({\n        name: 'estimateGas',\n        call: 'eth_estimateGas',\n        params: 1,\n        inputFormatter: [formatters.inputCallFormatter],\n        outputFormatter: utils.hexToNumber,\n        requestManager: _this._parent._requestManager,\n        accounts: ethAccounts,\n        // is eth.accounts (necessary for wallet signing)\n        defaultAccount: _this._parent.defaultAccount,\n        defaultBlock: _this._parent.defaultBlock\n      }).createFunction();\n      return estimateGas(args.options, args.callback);\n\n    case 'call':\n      // TODO check errors: missing \"from\" should give error on deploy and send, call ?\n      var call = new Method({\n        name: 'call',\n        call: 'eth_call',\n        params: 2,\n        inputFormatter: [formatters.inputCallFormatter, formatters.inputDefaultBlockNumberFormatter],\n        // add output formatter for decoding\n        outputFormatter: function (result) {\n          return _this._parent._decodeMethodReturn(_this._method.outputs, result);\n        },\n        requestManager: _this._parent._requestManager,\n        accounts: ethAccounts,\n        // is eth.accounts (necessary for wallet signing)\n        defaultAccount: _this._parent.defaultAccount,\n        defaultBlock: _this._parent.defaultBlock,\n        handleRevert: _this._parent.handleRevert,\n        abiCoder: abi\n      }).createFunction();\n      return call(args.options, args.defaultBlock, args.callback);\n\n    case 'send':\n      // return error, if no \"from\" is specified\n      if (!utils.isAddress(args.options.from)) {\n        return utils._fireError(errors.ContractNoFromAddressDefinedError(), defer.eventEmitter, defer.reject, args.callback);\n      }\n\n      if (_.isBoolean(this._method.payable) && !this._method.payable && args.options.value && args.options.value > 0) {\n        return utils._fireError(new Error('Can not send value to non-payable contract method or constructor'), defer.eventEmitter, defer.reject, args.callback);\n      } // make sure receipt logs are decoded\n\n\n      var extraFormatters = {\n        receiptFormatter: function (receipt) {\n          if (_.isArray(receipt.logs)) {\n            // decode logs\n            var events = _.map(receipt.logs, function (log) {\n              return _this._parent._decodeEventABI.call({\n                name: 'ALLEVENTS',\n                jsonInterface: _this._parent.options.jsonInterface\n              }, log);\n            }); // make log names keys\n\n\n            receipt.events = {};\n            var count = 0;\n            events.forEach(function (ev) {\n              if (ev.event) {\n                // if > 1 of the same event, don't overwrite any existing events\n                if (receipt.events[ev.event]) {\n                  if (Array.isArray(receipt.events[ev.event])) {\n                    receipt.events[ev.event].push(ev);\n                  } else {\n                    receipt.events[ev.event] = [receipt.events[ev.event], ev];\n                  }\n                } else {\n                  receipt.events[ev.event] = ev;\n                }\n              } else {\n                receipt.events[count] = ev;\n                count++;\n              }\n            });\n            delete receipt.logs;\n          }\n\n          return receipt;\n        },\n        contractDeployFormatter: function (receipt) {\n          var newContract = _this._parent.clone();\n\n          newContract.options.address = receipt.contractAddress;\n          return newContract;\n        }\n      };\n      var sendTransaction = new Method({\n        name: 'sendTransaction',\n        call: 'eth_sendTransaction',\n        params: 1,\n        inputFormatter: [formatters.inputTransactionFormatter],\n        requestManager: _this._parent._requestManager,\n        accounts: _this.constructor._ethAccounts || _this._ethAccounts,\n        // is eth.accounts (necessary for wallet signing)\n        defaultAccount: _this._parent.defaultAccount,\n        defaultBlock: _this._parent.defaultBlock,\n        transactionBlockTimeout: _this._parent.transactionBlockTimeout,\n        transactionConfirmationBlocks: _this._parent.transactionConfirmationBlocks,\n        transactionPollingTimeout: _this._parent.transactionPollingTimeout,\n        defaultCommon: _this._parent.defaultCommon,\n        defaultChain: _this._parent.defaultChain,\n        defaultHardfork: _this._parent.defaultHardfork,\n        handleRevert: _this._parent.handleRevert,\n        extraFormatters: extraFormatters,\n        abiCoder: abi\n      }).createFunction();\n      return sendTransaction(args.options, args.callback);\n\n    default:\n      throw new Error('Method \"' + args.type + '\" not implemented.');\n  }\n};\n\nmodule.exports = Contract;","map":{"version":3,"sources":["/Users/matt/Projects/sushiswap-frontend/node_modules/web3-eth-contract/src/index.js"],"names":["_","require","core","Method","utils","Subscription","subscription","formatters","errors","promiEvent","abi","Contract","jsonInterface","address","options","_this","args","Array","prototype","slice","call","arguments","Error","setProvider","packageInit","clearSubscriptions","_requestManager","constructor","isArray","ContractMissingABIError","lastArg","length","isObject","extend","_getOrSetDefaultOptions","Object","defineProperty","set","value","_address","toChecksumAddress","inputAddressFormatter","get","enumerable","methods","events","_jsonInterface","map","method","func","funcName","constant","stateMutability","payable","name","_jsonInterfaceMethodToString","type","signature","encodeFunctionSignature","_createTxObject","bind","parent","cascadeFunc","nextMethod","encodeEventSignature","event","_on","allEvents","defaultAccount","defaultBlock","handleRevert","val","common","defaultCommon","hardfork","defaultHardfork","chain","defaultChain","transactionPollingTimeout","transactionConfirmationBlocks","transactionBlockTimeout","provider","accounts","_ethAccounts","_getCallback","getCallback","isFunction","pop","_checkListener","ContractReservedEventError","getOrSetDefaultOptions","gasPrice","String","from","data","gas","gasLimit","_encodeEventABI","filter","result","f","undefined","forEach","inputBlockNumberFormatter","topics","anonymous","push","indexedTopics","inputs","i","indexed","v","encodeParameter","concat","toLowerCase","_decodeEventABI","outputLogFormatter","find","intf","indexedInputs","input","argTopics","returnValues","decodeLog","__length__","raw","_encodeMethodABI","methodSignature","_method","paramsABI","_parent","json","replace","inputLength","encodeParameters","_deployData","startsWith","returnValue","_decodeMethodReturn","outputs","decodeParameters","deploy","callback","ContractMissingDeployDataError","apply","deployData","_generateEventOptions","eventName","isString","ContractEventDoesNotExistError","isAddress","ContractNoAddressDefinedError","params","clone","once","ContractOnceRequiresCallbackError","fromBlock","err","res","sub","unsubscribe","subOptions","toBlock","console","warn","inputFormatter","inputLogFormatter","outputFormatter","subscriptionHandler","output","removed","emit","requestManager","subscribe","getPastEvents","getPastLogs","setRequestManager","buildCall","txObject","_executeMethod","request","send","encodeABI","estimateGas","InvalidNumberOfParams","_processExecuteArguments","defer","processedArgs","shift","isFinite","generateRequest","to","_fireError","eventEmitter","reject","ethAccounts","payload","inputCallFormatter","inputDefaultBlockNumberFormatter","format","hexToNumber","createFunction","abiCoder","ContractNoFromAddressDefinedError","isBoolean","extraFormatters","receiptFormatter","receipt","logs","log","count","ev","contractDeployFormatter","newContract","contractAddress","sendTransaction","inputTransactionFormatter","module","exports"],"mappings":"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","sourcesContent":["/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file contract.js\n *\n * To initialize a contract use:\n *\n *  var Contract = require('web3-eth-contract');\n *  Contract.setProvider('ws://localhost:8546');\n *  var contract = new Contract(abi, address, ...);\n *\n * @author Fabian Vogelsteller <fabian@ethereum.org>\n * @date 2017\n */\n\n\n\"use strict\";\n\n\nvar _ = require('underscore');\nvar core = require('web3-core');\nvar Method = require('web3-core-method');\nvar utils = require('web3-utils');\nvar Subscription = require('web3-core-subscriptions').subscription;\nvar formatters = require('web3-core-helpers').formatters;\nvar errors = require('web3-core-helpers').errors;\nvar promiEvent = require('web3-core-promievent');\nvar abi = require('web3-eth-abi');\n\n\n/**\n * Should be called to create new contract instance\n *\n * @method Contract\n * @constructor\n * @param {Array} jsonInterface\n * @param {String} address\n * @param {Object} options\n */\nvar Contract = function Contract(jsonInterface, address, options) {\n    var _this = this,\n        args = Array.prototype.slice.call(arguments);\n\n    if(!(this instanceof Contract)) {\n        throw new Error('Please use the \"new\" keyword to instantiate a web3.eth.Contract() object!');\n    }\n\n    this.setProvider = function () {\n        core.packageInit(_this, arguments);\n\n        _this.clearSubscriptions = _this._requestManager.clearSubscriptions;\n    };\n\n    // sets _requestmanager\n    core.packageInit(this, [this.constructor]);\n\n    this.clearSubscriptions = this._requestManager.clearSubscriptions;\n\n    if(!jsonInterface || !(Array.isArray(jsonInterface))) {\n        throw errors.ContractMissingABIError();\n    }\n\n    // create the options object\n    this.options = {};\n\n    var lastArg = args[args.length - 1];\n    if(_.isObject(lastArg) && !_.isArray(lastArg)) {\n        options = lastArg;\n\n        this.options = _.extend(this.options, this._getOrSetDefaultOptions(options));\n        if(_.isObject(address)) {\n            address = null;\n        }\n    }\n\n    // set address\n    Object.defineProperty(this.options, 'address', {\n        set: function(value){\n            if(value) {\n                _this._address = utils.toChecksumAddress(formatters.inputAddressFormatter(value));\n            }\n        },\n        get: function(){\n            return _this._address;\n        },\n        enumerable: true\n    });\n\n    // add method and event signatures, when the jsonInterface gets set\n    Object.defineProperty(this.options, 'jsonInterface', {\n        set: function(value){\n            _this.methods = {};\n            _this.events = {};\n\n            _this._jsonInterface = value.map(function(method) {\n                var func,\n                    funcName;\n\n                // make constant and payable backwards compatible\n                method.constant = (method.stateMutability === \"view\" || method.stateMutability === \"pure\" || method.constant);\n                method.payable = (method.stateMutability === \"payable\" || method.payable);\n\n\n                if (method.name) {\n                    funcName = utils._jsonInterfaceMethodToString(method);\n                }\n\n\n                // function\n                if (method.type === 'function') {\n                    method.signature = abi.encodeFunctionSignature(funcName);\n                    func = _this._createTxObject.bind({\n                        method: method,\n                        parent: _this\n                    });\n\n\n                    // add method only if not one already exists\n                    if(!_this.methods[method.name]) {\n                        _this.methods[method.name] = func;\n                    } else {\n                        var cascadeFunc = _this._createTxObject.bind({\n                            method: method,\n                            parent: _this,\n                            nextMethod: _this.methods[method.name]\n                        });\n                        _this.methods[method.name] = cascadeFunc;\n                    }\n\n                    // definitely add the method based on its signature\n                    _this.methods[method.signature] = func;\n\n                    // add method by name\n                    _this.methods[funcName] = func;\n\n\n                // event\n                } else if (method.type === 'event') {\n                    method.signature = abi.encodeEventSignature(funcName);\n                    var event = _this._on.bind(_this, method.signature);\n\n                    // add method only if not already exists\n                    if(!_this.events[method.name] || _this.events[method.name].name === 'bound ')\n                        _this.events[method.name] = event;\n\n                    // definitely add the method based on its signature\n                    _this.events[method.signature] = event;\n\n                    // add event by name\n                    _this.events[funcName] = event;\n                }\n\n\n                return method;\n            });\n\n            // add allEvents\n            _this.events.allEvents = _this._on.bind(_this, 'allevents');\n\n            return _this._jsonInterface;\n        },\n        get: function(){\n            return _this._jsonInterface;\n        },\n        enumerable: true\n    });\n\n    // get default account from the Class\n    var defaultAccount = this.constructor.defaultAccount;\n    var defaultBlock = this.constructor.defaultBlock || 'latest';\n\n    Object.defineProperty(this, 'handleRevert', {\n        get: function () {\n            if (_this.options.handleRevert === false || _this.options.handleRevert === true) {\n                return _this.options.handleRevert;\n            }\n\n            return this.constructor.handleRevert;\n        },\n        set: function (val) {\n            _this.options.handleRevert = val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'defaultCommon', {\n        get: function () {\n            return _this.options.common || this.constructor.defaultCommon;\n        },\n        set: function (val) {\n            _this.options.common = val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'defaultHardfork', {\n        get: function () {\n            return _this.options.hardfork || this.constructor.defaultHardfork;\n        },\n        set: function (val) {\n            _this.options.hardfork = val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'defaultChain', {\n        get: function () {\n            return _this.options.chain || this.constructor.defaultChain;\n        },\n        set: function (val) {\n            _this.options.chain = val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'transactionPollingTimeout', {\n        get: function () {\n            if (_this.options.transactionPollingTimeout === 0) {\n                return _this.options.transactionPollingTimeout;\n            }\n\n            return _this.options.transactionPollingTimeout || this.constructor.transactionPollingTimeout;\n        },\n        set: function (val) {\n            _this.options.transactionPollingTimeout = val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'transactionConfirmationBlocks', {\n        get: function () {\n            if (_this.options.transactionConfirmationBlocks === 0) {\n                return _this.options.transactionConfirmationBlocks;\n            }\n\n            return _this.options.transactionConfirmationBlocks || this.constructor.transactionConfirmationBlocks;\n        },\n        set: function (val) {\n            _this.options.transactionConfirmationBlocks = val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'transactionBlockTimeout', {\n        get: function () {\n            if (_this.options.transactionBlockTimeout === 0) {\n                return _this.options.transactionBlockTimeout;\n            }\n\n            return _this.options.transactionBlockTimeout || this.constructor.transactionBlockTimeout;\n        },\n        set: function (val) {\n            _this.options.transactionBlockTimeout = val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'defaultAccount', {\n        get: function () {\n            return defaultAccount;\n        },\n        set: function (val) {\n            if(val) {\n                defaultAccount = utils.toChecksumAddress(formatters.inputAddressFormatter(val));\n            }\n\n            return val;\n        },\n        enumerable: true\n    });\n    Object.defineProperty(this, 'defaultBlock', {\n        get: function () {\n            return defaultBlock;\n        },\n        set: function (val) {\n            defaultBlock = val;\n\n            return val;\n        },\n        enumerable: true\n    });\n\n    // properties\n    this.methods = {};\n    this.events = {};\n\n    this._address = null;\n    this._jsonInterface = [];\n\n    // set getter/setter properties\n    this.options.address = address;\n    this.options.jsonInterface = jsonInterface;\n\n};\n\n/**\n * Sets the new provider, creates a new requestManager, registers the \"data\" listener on the provider and sets the\n * accounts module for the Contract class.\n *\n * @method setProvider\n *\n * @param {string|provider} provider\n * @param {Accounts} accounts\n *\n * @returns void\n */\nContract.setProvider = function(provider, accounts) {\n    // Contract.currentProvider = provider;\n    core.packageInit(this, [provider]);\n\n    this._ethAccounts = accounts;\n};\n\n\n/**\n * Get the callback and modify the array if necessary\n *\n * @method _getCallback\n * @param {Array} args\n * @return {Function} the callback\n */\nContract.prototype._getCallback = function getCallback(args) {\n    if (args && _.isFunction(args[args.length - 1])) {\n        return args.pop(); // modify the args array!\n    }\n};\n\n/**\n * Checks that no listener with name \"newListener\" or \"removeListener\" is added.\n *\n * @method _checkListener\n * @param {String} type\n * @param {String} event\n * @return {Object} the contract instance\n */\nContract.prototype._checkListener = function(type, event){\n    if(event === type) {\n        throw errors.ContractReservedEventError(type);\n    }\n};\n\n\n/**\n * Use default values, if options are not available\n *\n * @method _getOrSetDefaultOptions\n * @param {Object} options the options gived by the user\n * @return {Object} the options with gaps filled by defaults\n */\nContract.prototype._getOrSetDefaultOptions = function getOrSetDefaultOptions(options) {\n    var gasPrice = options.gasPrice ? String(options.gasPrice): null;\n    var from = options.from ? utils.toChecksumAddress(formatters.inputAddressFormatter(options.from)) : null;\n\n    options.data = options.data || this.options.data;\n\n    options.from = from || this.options.from;\n    options.gasPrice = gasPrice || this.options.gasPrice;\n    options.gas = options.gas || options.gasLimit || this.options.gas;\n\n    // TODO replace with only gasLimit?\n    delete options.gasLimit;\n\n    return options;\n};\n\n\n/**\n * Should be used to encode indexed params and options to one final object\n *\n * @method _encodeEventABI\n * @param {Object} event\n * @param {Object} options\n * @return {Object} everything combined together and encoded\n */\nContract.prototype._encodeEventABI = function (event, options) {\n    options = options || {};\n    var filter = options.filter || {},\n        result = {};\n\n    ['fromBlock', 'toBlock'].filter(function (f) {\n        return options[f] !== undefined;\n    }).forEach(function (f) {\n        result[f] = formatters.inputBlockNumberFormatter(options[f]);\n    });\n\n    // use given topics\n    if(_.isArray(options.topics)) {\n        result.topics = options.topics;\n\n    // create topics based on filter\n    } else {\n\n        result.topics = [];\n\n        // add event signature\n        if (event && !event.anonymous && event.name !== 'ALLEVENTS') {\n            result.topics.push(event.signature);\n        }\n\n        // add event topics (indexed arguments)\n        if (event.name !== 'ALLEVENTS') {\n            var indexedTopics = event.inputs.filter(function (i) {\n                return i.indexed === true;\n            }).map(function (i) {\n                var value = filter[i.name];\n                if (!value) {\n                    return null;\n                }\n\n                // TODO: https://github.com/ethereum/web3.js/issues/344\n                // TODO: deal properly with components\n\n                if (_.isArray(value)) {\n                    return value.map(function (v) {\n                        return abi.encodeParameter(i.type, v);\n                    });\n                }\n                return abi.encodeParameter(i.type, value);\n            });\n\n            result.topics = result.topics.concat(indexedTopics);\n        }\n\n        if(!result.topics.length)\n            delete result.topics;\n    }\n\n    if(this.options.address) {\n        result.address = this.options.address.toLowerCase();\n    }\n\n    return result;\n};\n\n/**\n * Should be used to decode indexed params and options\n *\n * @method _decodeEventABI\n * @param {Object} data\n * @return {Object} result object with decoded indexed && not indexed params\n */\nContract.prototype._decodeEventABI = function (data) {\n    var event = this;\n\n    data.data = data.data || '';\n    data.topics = data.topics || [];\n    var result = formatters.outputLogFormatter(data);\n\n    // if allEvents get the right event\n    if(event.name === 'ALLEVENTS') {\n        event = event.jsonInterface.find(function (intf) {\n            return (intf.signature === data.topics[0]);\n        }) || {anonymous: true};\n    }\n\n    // create empty inputs if none are present (e.g. anonymous events on allEvents)\n    event.inputs = event.inputs || [];\n\n    // Handle case where an event signature shadows the current ABI with non-identical\n    // arg indexing. If # of topics doesn't match, event is anon.\n    if (!event.anonymous){\n        let indexedInputs = 0;\n        event.inputs.forEach(input => input.indexed ? indexedInputs++ : null);\n\n        if (indexedInputs > 0 && (data.topics.length !== indexedInputs + 1)){\n            event = {\n                anonymous: true,\n                inputs: []\n            };\n        }\n    }\n\n    var argTopics = event.anonymous ? data.topics : data.topics.slice(1);\n\n    result.returnValues = abi.decodeLog(event.inputs, data.data, argTopics);\n    delete result.returnValues.__length__;\n\n    // add name\n    result.event = event.name;\n\n    // add signature\n    result.signature = (event.anonymous || !data.topics[0]) ? null : data.topics[0];\n\n    // move the data and topics to \"raw\"\n    result.raw = {\n        data: result.data,\n        topics: result.topics\n    };\n    delete result.data;\n    delete result.topics;\n\n\n    return result;\n};\n\n/**\n * Encodes an ABI for a method, including signature or the method.\n * Or when constructor encodes only the constructor parameters.\n *\n * @method _encodeMethodABI\n * @param {Mixed} args the arguments to encode\n * @param {String} the encoded ABI\n */\nContract.prototype._encodeMethodABI = function _encodeMethodABI() {\n    var methodSignature = this._method.signature,\n        args = this.arguments || [];\n\n    var signature = false,\n        paramsABI = this._parent.options.jsonInterface.filter(function (json) {\n            return ((methodSignature === 'constructor' && json.type === methodSignature) ||\n                ((json.signature === methodSignature || json.signature === methodSignature.replace('0x','') || json.name === methodSignature) && json.type === 'function'));\n        }).map(function (json) {\n            var inputLength = (_.isArray(json.inputs)) ? json.inputs.length : 0;\n\n            if (inputLength !== args.length) {\n                throw new Error('The number of arguments is not matching the methods required number. You need to pass '+ inputLength +' arguments.');\n            }\n\n            if (json.type === 'function') {\n                signature = json.signature;\n            }\n            return _.isArray(json.inputs) ? json.inputs : [];\n        }).map(function (inputs) {\n            return abi.encodeParameters(inputs, args).replace('0x','');\n        })[0] || '';\n\n    // return constructor\n    if(methodSignature === 'constructor') {\n        if(!this._deployData)\n            throw new Error('The contract has no contract data option set. This is necessary to append the constructor parameters.');\n\n        if(!this._deployData.startsWith('0x')) {\n            this._deployData = '0x' + this._deployData;\n        }\n\n        return this._deployData + paramsABI;\n\n    }\n\n    // return method\n    var returnValue = (signature) ? signature + paramsABI : paramsABI;\n\n    if(!returnValue) {\n        throw new Error('Couldn\\'t find a matching contract method named \"'+ this._method.name +'\".');\n    }\n\n    return returnValue;\n};\n\n\n/**\n * Decode method return values\n *\n * @method _decodeMethodReturn\n * @param {Array} outputs\n * @param {String} returnValues\n * @return {Object} decoded output return values\n */\nContract.prototype._decodeMethodReturn = function (outputs, returnValues) {\n    if (!returnValues) {\n        return null;\n    }\n\n    returnValues = returnValues.length >= 2 ? returnValues.slice(2) : returnValues;\n    var result = abi.decodeParameters(outputs, returnValues);\n\n    if (result.__length__ === 1) {\n        return result[0];\n    }\n\n    delete result.__length__;\n    return result;\n};\n\n\n/**\n * Deploys a contract and fire events based on its state: transactionHash, receipt\n *\n * All event listeners will be removed, once the last possible event is fired (\"error\", or \"receipt\")\n *\n * @method deploy\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} EventEmitter possible events are \"error\", \"transactionHash\" and \"receipt\"\n */\nContract.prototype.deploy = function(options, callback){\n\n    options = options || {};\n\n    options.arguments = options.arguments || [];\n    options = this._getOrSetDefaultOptions(options);\n\n\n    // throw error, if no \"data\" is specified\n    if(!options.data) {\n        if (typeof callback === 'function'){\n            return callback(errors.ContractMissingDeployDataError());\n        }\n        throw errors.ContractMissingDeployDataError();\n    }\n\n    var constructor = _.find(this.options.jsonInterface, function (method) {\n        return (method.type === 'constructor');\n    }) || {};\n    constructor.signature = 'constructor';\n\n    return this._createTxObject.apply({\n        method: constructor,\n        parent: this,\n        deployData: options.data,\n        _ethAccounts: this.constructor._ethAccounts\n    }, options.arguments);\n\n};\n\n/**\n * Gets the event signature and outputFormatters\n *\n * @method _generateEventOptions\n * @param {Object} event\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} the event options object\n */\nContract.prototype._generateEventOptions = function() {\n    var args = Array.prototype.slice.call(arguments);\n\n    // get the callback\n    var callback = this._getCallback(args);\n\n    // get the options\n    var options = (_.isObject(args[args.length - 1])) ? args.pop() : {};\n\n    var eventName = (_.isString(args[0])) ? args[0] : 'allevents';\n    var event = (eventName.toLowerCase() === 'allevents') ? {\n            name: 'ALLEVENTS',\n            jsonInterface: this.options.jsonInterface\n        } : this.options.jsonInterface.find(function (json) {\n            return (json.type === 'event' && (json.name === eventName || json.signature === '0x'+ eventName.replace('0x','')));\n        });\n\n    if (!event) {\n        throw errors.ContractEventDoesNotExistError(eventName);\n    }\n\n    if (!utils.isAddress(this.options.address)) {\n        throw errors.ContractNoAddressDefinedError();\n    }\n\n    return {\n        params: this._encodeEventABI(event, options),\n        event: event,\n        callback: callback\n    };\n};\n\n/**\n * Adds event listeners and creates a subscription, and remove it once its fired.\n *\n * @method clone\n * @return {Object} the event subscription\n */\nContract.prototype.clone = function() {\n    return new this.constructor(this.options.jsonInterface, this.options.address, this.options);\n};\n\n\n/**\n * Adds event listeners and creates a subscription, and remove it once its fired.\n *\n * @method once\n * @param {String} event\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} the event subscription\n */\nContract.prototype.once = function(event, options, callback) {\n    var args = Array.prototype.slice.call(arguments);\n\n    // get the callback\n    callback = this._getCallback(args);\n\n    if (!callback) {\n        throw errors.ContractOnceRequiresCallbackError();\n    }\n\n    // don't allow fromBlock\n    if (options)\n        delete options.fromBlock;\n\n    // don't return as once shouldn't provide \"on\"\n    this._on(event, options, function (err, res, sub) {\n        sub.unsubscribe();\n        if(_.isFunction(callback)){\n            callback(err, res, sub);\n        }\n    });\n\n    return undefined;\n};\n\n/**\n * Adds event listeners and creates a subscription.\n *\n * @method _on\n *\n * @param {String} event\n * @param {Object} options\n * @param {Function} callback\n *\n * @return {Object} the event subscription\n */\nContract.prototype._on = function(){\n    var subOptions = this._generateEventOptions.apply(this, arguments);\n\n    if (subOptions.params && subOptions.params.toBlock) {\n        delete subOptions.params.toBlock;\n        console.warn('Invalid option: toBlock. Use getPastEvents for specific range.');\n    }\n\n    // prevent the event \"newListener\" and \"removeListener\" from being overwritten\n    this._checkListener('newListener', subOptions.event.name);\n    this._checkListener('removeListener', subOptions.event.name);\n\n    // TODO check if listener already exists? and reuse subscription if options are the same.\n\n    // create new subscription\n    var subscription = new Subscription({\n        subscription: {\n            params: 1,\n            inputFormatter: [formatters.inputLogFormatter],\n            outputFormatter: this._decodeEventABI.bind(subOptions.event),\n            // DUBLICATE, also in web3-eth\n            subscriptionHandler: function (output) {\n                if(output.removed) {\n                    this.emit('changed', output);\n                } else {\n                    this.emit('data', output);\n                }\n\n                if (_.isFunction(this.callback)) {\n                    this.callback(null, output, this);\n                }\n            }\n        },\n        type: 'eth',\n        requestManager: this._requestManager\n    });\n\n    subscription.subscribe('logs', subOptions.params, subOptions.callback || function () {});\n\n    return subscription;\n};\n\n/**\n * Get past events from contracts\n *\n * @method getPastEvents\n * @param {String} event\n * @param {Object} options\n * @param {Function} callback\n * @return {Object} the promievent\n */\nContract.prototype.getPastEvents = function(){\n    var subOptions = this._generateEventOptions.apply(this, arguments);\n\n    var getPastLogs = new Method({\n        name: 'getPastLogs',\n        call: 'eth_getLogs',\n        params: 1,\n        inputFormatter: [formatters.inputLogFormatter],\n        outputFormatter: this._decodeEventABI.bind(subOptions.event)\n    });\n    getPastLogs.setRequestManager(this._requestManager);\n    var call = getPastLogs.buildCall();\n\n    getPastLogs = null;\n\n    return call(subOptions.params, subOptions.callback);\n};\n\n\n/**\n * returns the an object with call, send, estimate functions\n *\n * @method _createTxObject\n * @returns {Object} an object with functions to call the methods\n */\nContract.prototype._createTxObject =  function _createTxObject(){\n    var args = Array.prototype.slice.call(arguments);\n    var txObject = {};\n\n    if(this.method.type === 'function') {\n\n        txObject.call = this.parent._executeMethod.bind(txObject, 'call');\n        txObject.call.request = this.parent._executeMethod.bind(txObject, 'call', true); // to make batch requests\n\n    }\n\n    txObject.send = this.parent._executeMethod.bind(txObject, 'send');\n    txObject.send.request = this.parent._executeMethod.bind(txObject, 'send', true); // to make batch requests\n    txObject.encodeABI = this.parent._encodeMethodABI.bind(txObject);\n    txObject.estimateGas = this.parent._executeMethod.bind(txObject, 'estimate');\n\n    if (args && this.method.inputs && args.length !== this.method.inputs.length) {\n        if (this.nextMethod) {\n            return this.nextMethod.apply(null, args);\n        }\n        throw errors.InvalidNumberOfParams(args.length, this.method.inputs.length, this.method.name);\n    }\n\n    txObject.arguments = args || [];\n    txObject._method = this.method;\n    txObject._parent = this.parent;\n    txObject._ethAccounts = this.parent.constructor._ethAccounts || this._ethAccounts;\n\n    if(this.deployData) {\n        txObject._deployData = this.deployData;\n    }\n\n    return txObject;\n};\n\n\n/**\n * Generates the options for the execute call\n *\n * @method _processExecuteArguments\n * @param {Array} args\n * @param {Promise} defer\n */\nContract.prototype._processExecuteArguments = function _processExecuteArguments(args, defer) {\n    var processedArgs = {};\n\n    processedArgs.type = args.shift();\n\n    // get the callback\n    processedArgs.callback = this._parent._getCallback(args);\n\n    // get block number to use for call\n    if(processedArgs.type === 'call' && args[args.length - 1] !== true && (_.isString(args[args.length - 1]) || isFinite(args[args.length - 1])))\n        processedArgs.defaultBlock = args.pop();\n\n    // get the options\n    processedArgs.options = (_.isObject(args[args.length - 1])) ? args.pop() : {};\n\n    // get the generateRequest argument for batch requests\n    processedArgs.generateRequest = (args[args.length - 1] === true)? args.pop() : false;\n\n    processedArgs.options = this._parent._getOrSetDefaultOptions(processedArgs.options);\n    processedArgs.options.data = this.encodeABI();\n\n    // add contract address\n    if(!this._deployData && !utils.isAddress(this._parent.options.address))\n        throw errors.ContractNoAddressDefinedError();\n\n    if(!this._deployData)\n        processedArgs.options.to = this._parent.options.address;\n\n    // return error, if no \"data\" is specified\n    if(!processedArgs.options.data)\n        return utils._fireError(new Error('Couldn\\'t find a matching contract method, or the number of parameters is wrong.'), defer.eventEmitter, defer.reject, processedArgs.callback);\n\n    return processedArgs;\n};\n\n/**\n * Executes a call, transact or estimateGas on a contract function\n *\n * @method _executeMethod\n * @param {String} type the type this execute function should execute\n * @param {Boolean} makeRequest if true, it simply returns the request parameters, rather than executing it\n */\nContract.prototype._executeMethod = function _executeMethod(){\n    var _this = this,\n        args = this._parent._processExecuteArguments.call(this, Array.prototype.slice.call(arguments), defer),\n        defer = promiEvent((args.type !== 'send')),\n        ethAccounts = _this.constructor._ethAccounts || _this._ethAccounts;\n\n    // simple return request for batch requests\n    if(args.generateRequest) {\n\n        var payload = {\n            params: [formatters.inputCallFormatter.call(this._parent, args.options)],\n            callback: args.callback\n        };\n\n        if(args.type === 'call') {\n            payload.params.push(formatters.inputDefaultBlockNumberFormatter.call(this._parent, args.defaultBlock));\n            payload.method = 'eth_call';\n            payload.format = this._parent._decodeMethodReturn.bind(null, this._method.outputs);\n        } else {\n            payload.method = 'eth_sendTransaction';\n        }\n\n        return payload;\n\n    }\n\n    switch (args.type) {\n        case 'estimate':\n\n            var estimateGas = (new Method({\n                name: 'estimateGas',\n                call: 'eth_estimateGas',\n                params: 1,\n                inputFormatter: [formatters.inputCallFormatter],\n                outputFormatter: utils.hexToNumber,\n                requestManager: _this._parent._requestManager,\n                accounts: ethAccounts, // is eth.accounts (necessary for wallet signing)\n                defaultAccount: _this._parent.defaultAccount,\n                defaultBlock: _this._parent.defaultBlock\n            })).createFunction();\n\n            return estimateGas(args.options, args.callback);\n\n        case 'call':\n\n            // TODO check errors: missing \"from\" should give error on deploy and send, call ?\n\n            var call = (new Method({\n                name: 'call',\n                call: 'eth_call',\n                params: 2,\n                inputFormatter: [formatters.inputCallFormatter, formatters.inputDefaultBlockNumberFormatter],\n                // add output formatter for decoding\n                outputFormatter: function (result) {\n                    return _this._parent._decodeMethodReturn(_this._method.outputs, result);\n                },\n                requestManager: _this._parent._requestManager,\n                accounts: ethAccounts, // is eth.accounts (necessary for wallet signing)\n                defaultAccount: _this._parent.defaultAccount,\n                defaultBlock: _this._parent.defaultBlock,\n                handleRevert: _this._parent.handleRevert,\n                abiCoder: abi\n            })).createFunction();\n\n            return call(args.options, args.defaultBlock, args.callback);\n\n        case 'send':\n\n            // return error, if no \"from\" is specified\n            if(!utils.isAddress(args.options.from)) {\n                return utils._fireError(errors.ContractNoFromAddressDefinedError(), defer.eventEmitter, defer.reject, args.callback);\n            }\n\n            if (_.isBoolean(this._method.payable) && !this._method.payable && args.options.value && args.options.value > 0) {\n                return utils._fireError(new Error('Can not send value to non-payable contract method or constructor'), defer.eventEmitter, defer.reject, args.callback);\n            }\n\n\n            // make sure receipt logs are decoded\n            var extraFormatters = {\n                receiptFormatter: function (receipt) {\n                    if (_.isArray(receipt.logs)) {\n\n                        // decode logs\n                        var events = _.map(receipt.logs, function(log) {\n                            return _this._parent._decodeEventABI.call({\n                                name: 'ALLEVENTS',\n                                jsonInterface: _this._parent.options.jsonInterface\n                            }, log);\n                        });\n\n                        // make log names keys\n                        receipt.events = {};\n                        var count = 0;\n                        events.forEach(function (ev) {\n                            if (ev.event) {\n                                // if > 1 of the same event, don't overwrite any existing events\n                                if (receipt.events[ev.event]) {\n                                    if (Array.isArray(receipt.events[ ev.event ])) {\n                                        receipt.events[ ev.event ].push(ev);\n                                    } else {\n                                        receipt.events[ev.event] = [receipt.events[ev.event], ev];\n                                    }\n                                } else {\n                                    receipt.events[ ev.event ] = ev;\n                                }\n                            } else {\n                                receipt.events[count] = ev;\n                                count++;\n                            }\n                        });\n\n                        delete receipt.logs;\n                    }\n                    return receipt;\n                },\n                contractDeployFormatter: function (receipt) {\n                    var newContract = _this._parent.clone();\n                    newContract.options.address = receipt.contractAddress;\n                    return newContract;\n                }\n            };\n\n            var sendTransaction = (new Method({\n                name: 'sendTransaction',\n                call: 'eth_sendTransaction',\n                params: 1,\n                inputFormatter: [formatters.inputTransactionFormatter],\n                requestManager: _this._parent._requestManager,\n                accounts: _this.constructor._ethAccounts || _this._ethAccounts, // is eth.accounts (necessary for wallet signing)\n                defaultAccount: _this._parent.defaultAccount,\n                defaultBlock: _this._parent.defaultBlock,\n                transactionBlockTimeout: _this._parent.transactionBlockTimeout,\n                transactionConfirmationBlocks: _this._parent.transactionConfirmationBlocks,\n                transactionPollingTimeout: _this._parent.transactionPollingTimeout,\n                defaultCommon: _this._parent.defaultCommon,\n                defaultChain: _this._parent.defaultChain,\n                defaultHardfork: _this._parent.defaultHardfork,\n                handleRevert: _this._parent.handleRevert,\n                extraFormatters: extraFormatters,\n                abiCoder: abi\n            })).createFunction();\n\n            return sendTransaction(args.options, args.callback);\n\n        default:\n            throw new Error('Method \"' + args.type + '\" not implemented.');\n\n    }\n\n\n};\n\nmodule.exports = Contract;\n"]},"metadata":{},"sourceType":"script"}